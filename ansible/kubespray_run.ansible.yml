- name: Deploy Kubernetes with Kubespray
  hosts: all
  gather_facts: no
  become: yes
  tasks:
    - name: Grant NOPASSWD sudo privileges
      ansible.builtin.shell:
        cmd: echo "ubuntu ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/ubuntu

    - name: Enable IP forwarding
      ansible.builtin.shell:
        cmd: echo 'net.ipv4.ip_forward=1' | sudo tee -a /etc/sysctl.conf

    - name: Disable swap
      ansible.builtin.shell:
        cmd: sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab && sudo swapoff -a


